version: "3"

services:
  # nginx
  nginx:
    # コンテナ名
    container_name: nginx
    # image
    image: nginx:alpine
    # スタブサーバー起動後に動く
    depends_on:
      - mocky
      - staticsite
    # コンテナに入るようにできる
    tty: true
    # ポート
    ports:
      - "80:80"
    # ボリューム（マウント）
    volumes:
      - ./dockers/nginx/conf.d:/etc/nginx/conf.d

  # スタブサーバ用
  mocky:
    # コンテナ名
    container_name: mocky
    # Dockerfile場所
    build: ./dockers/mocky
    # コンテナに入るようにできる
    tty: true
    # ボリューム
    volumes:
      - "./dockers/mocky/app:/usr/src/app"
    # ポート
    ports:
      - "4321:4321"
    # 作業ディレクトリ
    working_dir: /usr/src/app
    # 実行コマンド
    entrypoint: npm start

  # 静的サーバ用
  staticsite:
    # コンテナ名
    container_name: staticsite
    # image
    image: panubo/staticsite
    # コンテナに入るようにできる
    tty: true
    # ポート
    ports:
      - "8000:80"
    # ボリューム
    volumes:
      - "./dockers/staticsite/html:/var/www/html"
